!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs")):"function"==typeof define&&define.amd?define("signalk-client-angular",["exports","@angular/core","@angular/common/http","rxjs"],t):t(e["signalk-client-angular"]={},e.ng.core,e.ng.common.http,e.rxjs)}(this,function(e,s,a,t){"use strict";var n=function(){function e(e){this.http=e,this._version="v1",this._filter=null,this._wsTimeout=2e4,this.server={authRequired:!1,endpoints:{},info:{},apiVersions:[],ws:{self:null,roles:{}}},this._connect=new t.Subject,this.onConnect=this._connect.asObservable(),this._close=new t.Subject,this.onClose=this._close.asObservable(),this._error=new t.Subject,this.onError=this._error.asObservable(),this._message=new t.Subject,this.onMessage=this._message.asObservable(),this.init()}return e.prototype.debug=function(e){s.isDevMode()&&console.log(e)},Object.defineProperty(e.prototype,"version",{get:function(){return parseInt(this._version.slice(1))},set:function(e){var t="v"+e;0==this.server.apiVersions.length?(this._version=t,this.debug("Signal K api version set to: "+t)):(this._version=-1!=this.server.apiVersions.indexOf(t)?t:this._version,this.debug("Signal K api version set request: "+t+", result: "+this._version))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"apiVersions",{get:function(){return this.server.apiVersions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"authRequired",{get:function(){return this.server.authRequired},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"authToken",{set:function(e){this._token=e},enumerable:!0,configurable:!0}),e.prototype.login=function(e,t){var n=(new a.HttpHeaders).set("Content-Type","application/json");return this.http.post(this.protocol+"://"+this.hostname+":"+this.port+"/auth/login",{username:e,password:t},{headers:n})},e.prototype.logout=function(){var e=this.protocol+"://"+this.hostname+":"+this.port+"/auth/logout";return this._token&&(e+="&token="+this._token),this.http.put(e,{})},Object.defineProperty(e.prototype,"connectionTimeout",{get:function(){return this._wsTimeout},set:function(e){this._wsTimeout=e<3e3?3e3:6e4<e?6e4:e},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=!1),s.isDevMode()?(e=e||"192.168.99.100",t=t||3e3):e=e||"localhost",this.hostname=e,this.port=n?(this.protocol="https",this.wsProtocol="wss",t||443):(this.protocol="http",this.wsProtocol="ws",t||80)},e.prototype.hello=function(e,t,n){return void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=!1),this.init(e,t,n),this.get("/signalk")},e.prototype.connect=function(e,t,n,s){var i=this;void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=!1),void 0===s&&(s=null),this.debug("Contacting Signal K server........."),this.hello(e,t,n).subscribe(function(e){var t;if(i.server.endpoints=e.endpoints?e.endpoints:{},i.server.info=e.server?e.server:{},i.server.apiVersions=i.server.endpoints?Object.keys(i.server.endpoints):[],i.debug(i.server.endpoints),i.server.endpoints[i._version]&&i.server.endpoints[i._version]["signalk-ws"])i.debug("Connecting endpoint version: "+i._version),t=""+i.server.endpoints[i._version]["signalk-ws"];else{if(!i.server.endpoints.v1||!i.server.endpoints.v1["signalk-ws"])return void i._error.next(new Error("No Signal K endpoints found!"));i.debug("Connection falling back to: v1"),t=""+i.server.endpoints.v1["signalk-ws"]}s&&(t+="?subscribe="+s),i._token&&(t+="&token="+i._token),i.debug("Connecting to "+t),i.connectDeltaByUrl(t)},function(e){return i.server.endpoints={},i.server.info={},i.server.apiVersions=[],i._error.next(e)})},e.prototype.connectDelta=function(e,t,n,s){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=!1),void 0===s&&(s=null),this.debug("ConnectDelta........."),this.init(e,t,n);var i=this.wsProtocol+"://"+this.hostname+":"+this.port+"/signalk/"+this._version+"/stream";s&&(i+="?subscribe="+s),this._token&&(i+="&token="+this._token),this.debug("Connecting to delta stream at "+i),this.connectDeltaByUrl(i)},e.prototype.connectDeltaByUrl=function(e){var n=this;this.server.authRequired&&!this._token&&(this.debug("Auth Required and NO token available!"),this._error.next(new Error("Auth Required and NO token available!"))),this.ws&&this.disconnect(),this.ws=new WebSocket(e),setTimeout(function(){n.ws&&1!=n.ws.readyState&&3!=n.ws.readyState&&(n.debug("Connection watchdog expired ("+n._wsTimeout/1e3+" sec): "+n.ws.readyState+"... aborting connection..."),n.disconnect())},this._wsTimeout),this.ws.onopen=function(e){n.debug("ws.open"),n._connect.next(e)},this.ws.onclose=function(e){n.debug("ws.close"),n._close.next(e)},this.ws.onerror=function(e){n.debug("ws.error"),n._error.next(e)},this.ws.onmessage=function(e){var t;if("string"==typeof e.data)try{t=JSON.parse(e.data)}catch(e){return}n.isHello(t)&&(n.server.ws.roles=t.roles,n.server.ws.self=t.self),n._filter&&n.isDelta(t)?t.context==n._filter&&n._message.next(t):n._message.next(t)}},e.prototype.disconnect=function(){this.ws&&(this.ws.close(),this.ws=null,this.server.ws={self:null,roles:{}})},e.prototype.send=function(e){this.ws&&("object"==typeof e&&(e=JSON.stringify(e)),this.ws.send(e))},e.prototype.sendUpdate=function(e,t,n){void 0===e&&(e="self");var s={context:"self"==e?"vessels.self":e,updates:[{values:[{path:t,value:n}]}]};this.debug("sending update: "+JSON.stringify(s)),this.send(s)},e.prototype.subscribe=function(e,t){void 0===e&&(e="*"),void 0===t&&(t="*");for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];var i={context:"self"==e?"vessels.self":e,subscribe:[]},o={};for(var r in o.path=t,n)switch(r){case"0":isNaN(n[r])||(o.period=parseInt(n[r]));break;case"1":"delta"!=n[r]&&"full"!=n[r]||(o.format=n[r]);break;case"2":"instant"!=n[r]&&"ideal"!=n[r]&&"fixed"!=n[r]||(o.policy=n[r]);break;case"3":"instant"==o.policy&&(isNaN(n[r])||(o.minPeriod=parseInt(n[r])))}i.subscribe.push(o),this.send(i)},e.prototype.unsubscribe=function(e,t){void 0===e&&(e="*"),void 0===t&&(t="*"),e="self"==e?"vessels.self":e,this.send({context:e,unsubscribe:[{path:t}]})},e.prototype.isDelta=function(e){return"undefined"!=typeof e.context},e.prototype.isHello=function(e){return"undefined"!=typeof e.version},Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},set:function(e){var t=this;if(e)if(-1!=e.indexOf("self"))this.server.ws.self?this._filter=this.server.ws.self:this.getSelfId().subscribe(function(e){t._filter=e});else{var n=RegExp("^urn:mrn:signalk:uuid:[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-4[0-9A-Fa-f]{3}-[89ABab][0-9A-Fa-f]{3}-[0-9A-Fa-f]{12}$");-1!=e.indexOf("vessels.")&&(e=e.slice(e.indexOf(".")+1)),n.test(e)&&(this._filter="vessels."+e)}else this._filter=null},enumerable:!0,configurable:!0}),e.prototype.raiseAlarm=function(e,t,n){void 0===e&&(e="self"),this.sendUpdate(e,"notifications."+t,n)},e.prototype.clearAlarm=function(e,t){void 0===e&&(e="self"),this.sendUpdate(e,"notifications."+t,null)},e.prototype.getSelf=function(){return this.apiGet("vessels/self")},e.prototype.getSelfId=function(){return this.apiGet("self")},e.prototype.getMeta=function(e,t){return this.apiGet(this.contextToPath(e)+"/"+this.dotToSlash(t)+"/meta")},e.prototype.apiGet=function(e){var t=this.resolveHttpEndpoint();if(t){if("/"==e[0]&&(e=e.slice(1)),t+=this.dotToSlash(e),this.debug("apiGet "+t),this._token){var n=new a.HttpHeaders({Authorization:"JWT "+this._token});return this.http.get(t,{headers:n})}return this.server.authRequired&&(this.debug("Auth Required and NO token available!"),this._error.next(new Error("Auth Required and NO token available!"))),this.http.get(t)}},e.prototype.apiPut=function(e,t,n,s){var i=this.resolveHttpEndpoint();if(i){"/"==t[0]&&(t=t.slice(1)),i+=this.contextToPath(e)+"/"+this.dotToSlash(t);var o={value:{}};if(void 0===s?o.value=n:o.value[n]=s,this.debug("apiPut "+i),this.debug(JSON.stringify(o)),this._token){var r=new a.HttpHeaders({Authorization:"JWT "+this._token});return this.http.put(i,o,{headers:r})}return this.server.authRequired&&(this.debug("Auth Required and NO token available!"),this._error.next(new Error("Auth Required and NO token available!"))),this.http.put(i,o)}},e.prototype.get=function(e){var t=this.protocol+"://"+this.hostname+":"+this.port+this.dotToSlash(e);if(this.debug("get "+t),this._token){var n=new a.HttpHeaders({Authorization:"JWT "+this._token});return this.http.get(t,{headers:n})}return this.server.authRequired&&(this.debug("Auth Required and NO token available!"),this._error.next(new Error("Auth Required and NO token available!"))),this.http.get(t)},e.prototype.put=function(e,t){var n=this.protocol+"://"+this.hostname+":"+this.port+this.dotToSlash(e);if(this.debug("put "+n),this._token){var s=new a.HttpHeaders({Authorization:"JWT "+this._token});return this.http.put(n,{headers:s})}return this.server.authRequired&&(this.debug("Auth Required and NO token available!"),this._error.next(new Error("Auth Required and NO token available!"))),this.http.put(n,t)},e.prototype.post=function(e,t){var n=this.protocol+"://"+this.hostname+":"+this.port+this.dotToSlash(e);if(this.debug("post "+n),this._token){var s=new a.HttpHeaders({Authorization:"JWT "+this._token});return this.http.post(n,{headers:s})}return this.server.authRequired&&(this.debug("Auth Required and NO token available!"),this._error.next(new Error("Auth Required and NO token available!"))),this.http.post(n,t)},e.prototype.resolveHttpEndpoint=function(){var e;if(this.server.endpoints[this._version])e=this.server.endpoints[this._version]["signalk-http"]?""+this.server.endpoints[this._version]["signalk-http"]:""+this.server.endpoints.v1["signalk-http"];else{var t="No current connection http endpoint service! Use connect() to establish a connection.";this.debug(t),this._error.next(new Error(t))}return e},e.prototype.contextToPath=function(e){return("self"==e?"vessels.self":e).split(".").join("/")},e.prototype.dotToSlash=function(e){return-1!=e.indexOf(".")?e.split(".").join("/"):e},e.prototype.slashToDot=function(e){return-1!=e.indexOf("/")?e.split("/").join("."):e},e.decorators=[{type:s.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:a.HttpClient}]},e.ngInjectableDef=s.defineInjectable({factory:function(){return new e(s.inject(a.HttpClient))},token:e,providedIn:"root"}),e}(),i={normal:"normal",alert:"alert",warn:"warn",alarm:"alarm",emergency:"emergency"},o={visual:"visual",sound:"sound"},r=function u(e){void 0===e&&(e=null),this.state=i.normal,this.method=[o.visual,o.sound],this.message=e};e.SignalKClient=n,e.AlarmState=i,e.AlarmMethod=o,e.Alarm=r,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=signalk-client-angular.umd.min.js.map