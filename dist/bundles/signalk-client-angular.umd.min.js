!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs")):"function"==typeof define&&define.amd?define("signalk-client-angular",["exports","@angular/core","@angular/common/http","rxjs"],t):t(e["signalk-client-angular"]={},e.ng.core,e.ng.common.http,e.rxjs)}(this,function(e,n,t,s){"use strict";var i=function(){function e(e){this.http=e,this._version="v1",this._filter=null,this.server={endpoints:{},info:{},apiVersions:[],ws:{self:null,roles:{}}},this._connect=new s.Subject,this.onConnect=this._connect.asObservable(),this._close=new s.Subject,this.onClose=this._close.asObservable(),this._error=new s.Subject,this.onError=this._error.asObservable(),this._message=new s.Subject,this.onMessage=this._message.asObservable(),this.init()}return e.prototype.debug=function(e){n.isDevMode()&&console.log(e)},Object.defineProperty(e.prototype,"version",{get:function(){return parseInt(this._version.slice(1))},set:function(e){var t="v"+e;0==this.server.apiVersions.length?(this._version=t,this.debug("Signal K api version set to: "+t)):(this._version=-1!=this.server.apiVersions.indexOf(t)?t:this._version,this.debug("Signal K api version set request: "+t+", result: "+this._version))},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t,s){void 0===e&&(e=null),void 0===t&&(t=null),void 0===s&&(s=!1),n.isDevMode()?(e=e||"192.168.99.100",t=t||3e3):e=e||"localhost",this.hostname=e,s?(this.protocol="https",this.wsProtocol="wss",this.port=t||443):(this.protocol="http",this.wsProtocol="ws",this.port=t||80)},e.prototype.hello=function(e,t,s){return void 0===e&&(e=null),void 0===t&&(t=null),void 0===s&&(s=!1),this.init(e,t,s),this.get("/signalk")},e.prototype.connect=function(e,t,s,n){var i=this;void 0===e&&(e=null),void 0===t&&(t=null),void 0===s&&(s=!1),void 0===n&&(n=null),this.debug("Contacting Signal K server........."),this.hello(e,t).subscribe(function(e){var t;if(i.server.endpoints=e.endpoints?e.endpoints:{},i.server.info=e.server?e.server:{},i.server.apiVersions=i.server.endpoints?Object.keys(i.server.endpoints):[],i.debug(i.server.endpoints),i.server.endpoints[i._version]&&i.server.endpoints[i._version]["signalk-ws"])i.debug("Connecting endpoint version: "+i._version),t=""+i.server.endpoints[i._version]["signalk-ws"];else{if(!i.server.endpoints.v1||!i.server.endpoints.v1["signalk-ws"])return void i._error.next(new Error("No Signal K endpoints found!"));i.debug("Connection falling back to: v1"),t=""+i.server.endpoints.v1["signalk-ws"]}n&&-1!=["self","all","none"].indexOf(n)&&(t+="?subscribe="+n),i.debug("Connecting to "+t),i.connectDeltaByUrl(t)},function(e){return i.server.endpoints={},i.server.info={},i.server.apiVersions=[],i._error.next(e)})},e.prototype.connectDelta=function(e,t,s,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===s&&(s=!1),void 0===n&&(n=null),this.debug("ConnectDelta........."),this.init(e,t,s);var i=this.wsProtocol+"://"+this.hostname+":"+this.port+"/signalk/"+this._version+"/stream";n&&-1!=["self","all","none"].indexOf(n)&&(i+="?subscribe="+n),this.debug("Connecting to delta stream at "+i),this.connectDeltaByUrl(i)},e.prototype.connectDeltaByUrl=function(e){var s=this;this.ws&&this.disconnect(),this.ws=new WebSocket(e),this.ws.onopen=function(e){s.debug("ws.open"),s._connect.next(e)},this.ws.onclose=function(e){s.debug("ws.close"),s._close.next(e)},this.ws.onerror=function(e){s.debug("ws.error"),s._error.next(e)},this.ws.onmessage=function(e){var t;if("string"==typeof e.data)try{t=JSON.parse(e.data)}catch(e){return}s.isHello(t)&&(s.server.ws.roles=t.roles,s.server.ws.self=t.self),s._filter&&s.isDelta(t)?t.context==s._filter&&s._message.next(t):s._message.next(t)}},e.prototype.disconnect=function(){this.ws.close(),this.ws=null,this.server.ws={self:null,roles:{}}},e.prototype.send=function(e){this.ws&&("object"==typeof e&&(e=JSON.stringify(e)),this.ws.send(e))},e.prototype.subscribe=function(e,t){void 0===e&&(e="*"),void 0===t&&(t="*");for(var s=[],n=2;n<arguments.length;n++)s[n-2]=arguments[n];var i={context:"self"==e?"vessels.self":e,subscribe:[]},o={};for(var r in o.path=t,s)switch(r){case"0":isNaN(s[r])||(o.period=parseInt(s[r]));break;case"1":"delta"!=s[r]&&"full"!=s[r]||(o.format=s[r]);break;case"2":"instant"!=s[r]&&"ideal"!=s[r]&&"fixed"!=s[r]||(o.policy=s[r]);break;case"3":"instant"==o.policy&&(isNaN(s[r])||(o.minPeriod=parseInt(s[r])))}i.subscribe.push(o),this.send(i)},e.prototype.unsubscribe=function(e,t){void 0===e&&(e="*"),void 0===t&&(t="*"),e="self"==e?"vessels.self":e,this.send({context:e,unsubscribe:[{path:t}]})},e.prototype.isDelta=function(e){return"undefined"!=typeof e.context},e.prototype.isHello=function(e){return"undefined"!=typeof e.version},Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},set:function(e){var t=this;if(e)if(-1!=e.indexOf("self"))this.server.ws.self?this._filter=this.server.ws.self:this.getSelfId().subscribe(function(e){t._filter=e});else{var s=RegExp("^urn:mrn:signalk:uuid:[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-4[0-9A-Fa-f]{3}-[89ABab][0-9A-Fa-f]{3}-[0-9A-Fa-f]{12}$");-1!=e.indexOf("vessels.")&&(e=e.slice(e.indexOf(".")+1)),s.test(e)&&(this._filter="vessels."+e)}else this._filter=null},enumerable:!0,configurable:!0}),e.prototype.getSelf=function(){return this.apiGet("vessels/self")},e.prototype.getSelfId=function(){return this.apiGet("self")},e.prototype.getMeta=function(e,t){return this.apiGet(this.contextToPath(e)+"/"+t.split(".").join("/")+"/meta")},e.prototype.apiGet=function(e){var t=this.resolveHttpEndpoint();if(t)return"/"==e[0]&&(e=e.slice(1)),t+=e,this.debug("apiGet "+t),this.http.get(t)},e.prototype.apiPut=function(e,t,s,n){var i=this.resolveHttpEndpoint();if(i){"/"==t[0]&&(t=t.slice(1)),i+=this.contextToPath(e)+"/"+t;var o={value:{}};return o.value[s]=n,this.debug("apiPut "+i),this.debug(JSON.stringify(o)),this.http.put(i,o)}},e.prototype.get=function(e){var t=this.protocol+"://"+this.hostname+":"+this.port+e;return this.debug("get "+t),this.http.get(t)},e.prototype.resolveHttpEndpoint=function(){var e;if(this.server.endpoints[this._version])e=this.server.endpoints[this._version]["signalk-http"]?""+this.server.endpoints[this._version]["signalk-http"]:""+this.server.endpoints.v1["signalk-http"];else{var t="No current connection http endpoint service! Use connect() to establish a connection.";this.debug(t),this._error.next(new Error(t))}return e},e.prototype.contextToPath=function(e){return("self"==e?"vessels.self":e).split(".").join("/")},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:t.HttpClient}]},e.ngInjectableDef=n.defineInjectable({factory:function(){return new e(n.inject(t.HttpClient))},token:e,providedIn:"root"}),e}();e.SignalKClient=i,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=signalk-client-angular.umd.min.js.map